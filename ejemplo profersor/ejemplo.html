<!doctype html>
<html>
	<head>
		<title>Electro</title>
		<meta charset="UTF-8">
		
		<style>
			html, body { margin: 0; padding: 0; }
			body, button, input { font-family: Courier New, Courier, monospace; font-size: 12px; }
			h1 { background-color: #88a; padding: 8px; margin: 0 0 16px 0; text-align: center; }
			table { width: 75%; margin: auto; border-spacing: 4px; }
			tr > * { padding: 16px 4px; }
			td { background-color: #aaa; text-align: center; }
			th { background-color: #a88; }
			#grafico { background-color: #ddd; margin: 16px auto; padding: 8px; display: block; }			
		</style>
	</head>
	<body class="conf">
		<h1>Electro</h1>

		<h2>Configuraci&oacute;n</h2>	
		<table>
			<tr>
				<th>R. Superior</th>
				<th>R. Inferior</th>
				<th>Gratinador</th>
				<th>Ventilador</th>
				<th>Temperatura</th>
				<th>Tiempo</th>
			</tr>
			<tr>
				<td><input id="confRS" type="checkbox" onchange="confRS = this.checked; ajustar();" /></td>
				<td><input id="confRI" type="checkbox" onchange="confRI = this.checked; ajustar();" /></td>
				<td><input id="confG" type="checkbox" onchange="confG = this.checked; ajustar();" /></td>
				<td><input id="confV" type="checkbox" onchange="confV = this.checked; ajustar();" /></td>
				<td>
					<span id="confTemp"></span> &deg;C<br />
					<button onclick="cambiarTemp(-5)">-5</button><button onclick="cambiarTemp(5)">+5</button><br />
					<button onclick="cambiarTemp(-1)">-1</button><button onclick="cambiarTemp(1)">+1</button>
				</td>
				<td>
					<span id="confTiempo"></span><br />
					<button onclick="cambiarTiempo(-300)">-5</button><button onclick="cambiarTiempo(300)">+5</button><br />
					<button onclick="cambiarTiempo(-60)">-1</button><button onclick="cambiarTiempo(60)">+1</button><br />
				</td>
			</tr>
		</table>

		<h2>Sensores</h2>	
		<table>
			<tr>
				<th>Temp. Exterior</th>
				<th>Temp. Interior</th>
				<th>Puerta</th>
				<th>Consumo</th>
				<th>Hora</th>
			</tr>
			<tr>
				<td><span id="sensorTempExterior"></span> &deg;C</td>
				<td><span id="sensorTempInterior"></span> &deg;C</td>
				<td><span id="sensorPuerta"></span></td>
				<td><span id="sensorConsumo"></span> W</td>
				<td><span id="sensorHora"></span></td>
			</tr>
		</table>

		<h2>Par&aacute;metros</h2>	
		<table>
			<tr>
				<th>R. Superior</th>
				<th>R. Inferior</th>
				<th>Gratinador</th>
				<th>Ventilador</th>
				<th>Pitido</th>
			</tr>
			<tr>
				<td><span id="paramRS"></span></td>
				<td><span id="paramRI"></span></td>
				<td><span id="paramG"></span></td>
				<td><span id="paramV"></span></td>
				<td><span id="paramPitido"></span></td>
			</tr>
		</table>

	<script src="electro.js"></script>
	<script>
		// crea un texto de dos digitos para un valor numérico
		function dosDigitos(v) {
			v = "00" + v;
			return v.substr(v.length - 2);
		}

		// ---- Configuraciones ----

		// Funciones del horno
		var confRS = false;
		var confRI = false;
		var confG = false;
		var confV = false;

		// Temperatura
		var confTemp = 0;
		function cambiarTemp (temp) {
			confTemp += temp;
			if (confTemp < 0) confTemp = 0;
			document.getElementById("confTemp").innerHTML = confTemp;
			ajustar();
		}
		cambiarTemp(0);

		// Tiempo
		var confTiempo = 0;
		function cambiarTiempo (tiempo) {
			confTiempo += tiempo;
			if (confTiempo < 0) confTiempo = 0;
			document.getElementById("confTiempo").innerHTML = dosDigitos(Math.floor(confTiempo / 60)) + ":" + dosDigitos(confTiempo % 60);
			ajustar();
		}
		cambiarTiempo(0);

		// ---- Sensores ----

		// Temperatura exterior
		function sensorTempExterior (temp) {
			document.getElementById("sensorTempExterior").innerHTML = temp.toFixed(2);
		}
		electro.tempExterior(sensorTempExterior);

		// Temperatura interior
		function sensorTempInterior (temp) {
			document.getElementById("sensorTempInterior").innerHTML = temp.toFixed(2);
			ajustar();
		}
		electro.tempInterior(sensorTempInterior);

		// Puerta
		var sto = null;
		function sensorPuerta (estado) {
			document.getElementById("sensorPuerta").innerHTML = estado ? "Abierta" : "Cerrada";
			ajustar();
			if (estado && !sto) {
				sto = setTimeout(function () { electro.pitido(true); }, 5000);
			} else {
				if (sto) {
					clearTimeout(sto);
					sto = null;
				}
				electro.pitido(false);
			}
		}
		electro.puerta(sensorPuerta);

		// Consumo
		function sensorConsumo (watios) {
			console.log(watios);
			document.getElementById("sensorConsumo").innerHTML = watios;
		}
		electro.consumo(sensorConsumo);

		// Hora
		function sensorHora (hora) {
			document.getElementById("sensorHora").innerHTML = dosDigitos(hora.getHours()) + ":" + dosDigitos(hora.getMinutes()) + ":" + dosDigitos(hora.getSeconds());
			if (confTiempo) cambiarTiempo(-1); // decrementar el temporizador			
			ajustar();
		}
		electro.hora(sensorHora);

		// ---- Parametros ----

		function paramRS (estado) {
			document.getElementById("paramRS").innerHTML = estado ? "Encendido" : "Apagado";

			console.log(estado);
		}
		electro.resistenciaSuperior(paramRS);
		
		function paramRI (estado) {
			document.getElementById("paramRI").innerHTML = estado ? "Encendido" : "Apagado";
		}
		electro.resistenciaInferior(paramRI);
		
		function paramG (estado) {
			document.getElementById("paramG").innerHTML = estado ? "Encendido" : "Apagado";
		}
		electro.gratinador(paramG);
		
		function paramV (estado) {
			document.getElementById("paramV").innerHTML = estado ? "Encendido" : "Apagado";
		}
		electro.ventilador(paramV);
		
		function paramPitido (estado) {
			document.getElementById("paramPitido").innerHTML = estado ? "Encendido" : "Apagado";
		}
		electro.pitido(paramPitido);		

		// Ajusta los parámetros en función de los sensores y de la configuración establecida
		function ajustar () {
			var temp = electro.tempInterior() < confTemp;
			var tiempo = confTiempo > 0;
			var encendido = temp && tiempo;
			electro.resistenciaSuperior(encendido && confRS);
			electro.resistenciaInferior(encendido && confRI);
			electro.gratinador(encendido && confG);
			electro.ventilador(tiempo && confV);
		}

	</script>

	</body>


</html>
